# 使用计算资源 - SLURM

用户可以提交作业到集群，由 SLURM 分配计算资源。目前，在实验室集群只能提交以下作业：

- OpenMP 程序；
- 单节点上运行 MPI 程序。

>  注：多节点上运行 MPI 程序的功能还在配置中，暂勿使用。

用户可以直接提交一个作业，待执行完成后查看返回结果；也可以申请计算资源，登陆到相应的节点上完成操作。在得到计算资源后（比如作业运行期间），用户可以使用 SSH 登陆到分配给自己的节点上。在提交作业之间，请检查现有的空闲计算资源。

## 如何查看信息

SLURM 提供了一系列命令用于查看分区、节点、作业等信息。以下给出简单的用法。

### 查看分区信息 - sinfo

该命令用于查看当前集群的所有分区信息，包括分区和节点的状态。

```
$ sinfo
PARTITION AVAIL TIMELIMIT NODES STATE NODELIST
Balerion	 up	  1:00:00	  4	down* node[17-20]
Balerion	 up	  1:00:00	  3	 idle node[21-23]
Vhagar*		 up	  3:00:00	  2	alloc node[05-06]
Vhagar*		 up	  3:00:00	  6	 idle node[07-12]
```

`PARTITION`	指明了节点的分区，每个任务都只能提交到分区中，不能跨分区。默认分区的名称后有`*`号；

`AVAIL`		指明了分区的状态，`UP`表示分区可用；

`TIMELIMIT`	指明了分区对作业的时间限制，所有提交到该分区的作业都不能超过时间上限；

`NODES`		指明了分区中的节点数量，这是该分区所有可以分配给用户的计算节点；

`STATE`		指明了节点的状态。常见状态：`down`表示不可用，`idle`表示空闲节点，`alloc`表示已完全分配给用户使用，`mix`表示已分配给用户，但仍有剩余的计算资源。同一分区可能会占据多个条目，这是因为分区中节点的状态不同；

`NODELIST`	指明了节点的名称。

### 查看作业队列 - squeue

该命令用于查看当前在队列中的作业。可以通过参数筛选作业，具体参数见手册。

```
$ squeue
```

### 查看历史作业 - sacct

直接运行该命令，可以查看当前用户的历史作业。可以通过参数调整输出，具体参数见手册。

```
$ sacct
```

### 查看详细信息 - scontrol show

该命令可以查看很多信息，比如分区、节点的详细信息。示例如下。

查看所有分区信息/查看某个分区的信息：

```
$ scontrol show partition
$ scontrol show Vhagar
```

查看所有节点信息/查看某个节点的信息：

```
$ scontrol show node
$ scontrol show node node05
```

查看所有作业信息/查看某个作业的信息：

```
$ scontrol show job
$ scontrol show job 103
```
