"use strict";(self.webpackChunkhpcer_cluster_docs=self.webpackChunkhpcer_cluster_docs||[]).push([[9720],{1773:function(n){n.exports=JSON.parse('{"blogPosts":[{"id":"one-spack-on-supercomputers","metadata":{"permalink":"/cluster-docs/blog/one-spack-on-supercomputers","editUrl":"https://github.com/hpcde/cluster-docs/blob/master/blog/2020-12-16-one-spack-on-supercomputers.md","source":"@site/blog/2020-12-16-one-spack-on-supercomputers.md","title":"\u5982\u4f55\u5728\u8d85\u7b97\u4e0a\u914d\u7f6eSpack","description":"\u5b9e\u9a8c\u5ba4\u96c6\u7fa4\u6587\u6863\u4ecb\u7ecd\u4e86\u5982\u4f55\u914d\u7f6e\u3001\u4f7f\u7528 Spack\u3002\u672c\u6587\u7528\u5177\u4f53\u7684\u4f8b\u5b50\u6765\u6f14\u793a\u5982\u4f55\u5728\u8d85\u7b97\u4e0a\u914d\u7f6e Spack\uff0c\u4e3b\u8981\u5185\u5bb9\u5982\u4e0b\uff1a","date":"2020-12-16T00:00:00.000Z","formattedDate":"December 16, 2020","tags":[{"label":"tutorial","permalink":"/cluster-docs/blog/tags/tutorial"},{"label":"spack","permalink":"/cluster-docs/blog/tags/spack"}],"readingTime":16.39,"truncated":true,"authors":[{"name":"one","title":"PhD student at USTB","url":"https://github.com/alephpiece","imageURL":"https://github.com/alephpiece.png"}],"frontMatter":{"slug":"one-spack-on-supercomputers","title":"\u5982\u4f55\u5728\u8d85\u7b97\u4e0a\u914d\u7f6eSpack","author":"one","author_title":"PhD student at USTB","author_url":"https://github.com/alephpiece","author_image_url":"https://github.com/alephpiece.png","tags":["tutorial","spack"]},"nextItem":{"title":"\u5b9e\u7528\u5de5\u5177\uff1aTerminal Multiplexers","permalink":"/cluster-docs/blog/one-terminal-multiplexers"}},"content":"\u5b9e\u9a8c\u5ba4\u96c6\u7fa4\u6587\u6863\u4ecb\u7ecd\u4e86\u5982\u4f55\u914d\u7f6e\u3001\u4f7f\u7528 Spack\u3002\u672c\u6587\u7528\u5177\u4f53\u7684\u4f8b\u5b50\u6765\u6f14\u793a\u5982\u4f55\u5728\u8d85\u7b97\u4e0a\u914d\u7f6e Spack\uff0c\u4e3b\u8981\u5185\u5bb9\u5982\u4e0b\uff1a\\n\\n- \u51c6\u5907\u5fc5\u8981\u7684\u6570\u636e\\n- \u914d\u7f6e Spack\uff0c\u4fee\u6539\u914d\u7f6e\u6587\u4ef6\\n- \u6dfb\u52a0\u7f16\u8bd1\u5668\u548c\u5916\u90e8\u8f6f\u4ef6\u5305\\n- \u81ea\u5b9a\u4e49\u8f6f\u4ef6\u5305\uff0c\u5b89\u88c5\u8f6f\u4ef6\u5305\\n- \u5bfc\u51fa\u6a21\u5757\u6587\u4ef6\\n- \u4f7f\u7528\u65b0\u5b89\u88c5\u7684\u8f6f\u4ef6\u5305\\n\\n\u672c\u6587\u6d89\u53ca\u7684\u6240\u6709\u5185\u5bb9\u57fa\u672c\u90fd\u5305\u542b\u5728\u5b9e\u9a8c\u5ba4\u96c6\u7fa4\u6587\u6863\u548c Spack \u5b98\u65b9\u6587\u6863\u4e2d\uff0c\u56e0\u6b64\u4e0d\u518d\u4e13\u95e8\u7ed9\u51fa\u94fe\u63a5\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n## \u8d85\u7b97\u73af\u5883\u8bf4\u660e\\n\\n\u4e3a\u4e86\u4fbf\u4e8e\u53d9\u8ff0\uff0c\u6211\u4eec\u5047\u5b9a\u8d85\u7b97\u7684\u76f8\u5173\u53c2\u6570\u3001\u73af\u5883\u5982\u4e0b\uff1a\\n\\n| \u53c2\u6570\u540d           | \u503c                                                           |\\n| ---------------- | ------------------------------------------------------------ |\\n| \u540d\u79f0             | S                                                            |\\n| \u67b6\u6784             | x86_64                                                       |\\n| \u64cd\u4f5c\u7cfb\u7edf         | CentOS 7                                                     |\\n| \u6a21\u5757\u7cfb\u7edf         | Environment Modules                                          |\\n| \u4f5c\u4e1a\u8c03\u5ea6\u7cfb\u7edf     | Slurm                                                        |\\n| \u5df2\u6709\u6a21\u5757         | `compiler/gcc/10.2.0`<br />`mpi/hpcx/2.5`<br />`tools/cmake/3.19.3` |\\n\\n## \u62f7\u8d1d\u5fc5\u8981\u6570\u636e\\n\\n\u6309\u7167\u5b9e\u9a8c\u5ba4\u96c6\u7fa4\u6587\u6863\u4e2d\u7684\u8bf4\u660e\uff0c\u6211\u4eec\u5728\u8d85\u7b97 S \u4e0a\u5efa\u7acb\u5982\u4e0b\u51e0\u4e2a\u76ee\u5f55\u5e76\u62f7\u8d1d\u76f8\u5e94\u6570\u636e\uff1a\\n\\n- `~/public/spack`\uff1a\u5b58\u653e Spack \u4ed3\u5e93\\n- `~/public/repos/spack`\uff1aSpack repos\uff0c\u53ef\u80fd\u6709\u591a\u4e2a\u5b50\u76ee\u5f55\uff0c\u5b58\u653e\u6211\u4eec\u81ea\u5b9a\u4e49\u7684\u8f6f\u4ef6\u5305\u914d\u7f6e\u6587\u4ef6\uff08`package.py`\uff09\\n- `~/public/sources/spack`\uff1aSpack mirror\uff0c\u5b58\u653e\u6240\u6709\u8f6f\u4ef6\u5305\u7684\u6e90\u4ee3\u7801\\n- `~/public/software/spack`\uff1aSpack \u8f6f\u4ef6\u5b89\u88c5\u8def\u5f84\uff0c\u6700\u521d\u4e3a\u7a7a\u76ee\u5f55\\n- `~/.spack`\uff1aSpack \u914d\u7f6e\u6587\u4ef6\u3001\u7f13\u5b58\u8def\u5f84\uff0c\u7531 Spack \u81ea\u52a8\u521b\u5efa\\n\\n## \u914d\u7f6e Spack \u7684\u73af\u5883\\n\\n\u6570\u636e\u51c6\u5907\u5b8c\u6210\u540e\uff0c\u521b\u5efa\u4e00\u4e2a\u811a\u672c\u65b9\u4fbf\u6211\u4eec\u542f\u7528 Spack\uff0c\u4e0b\u9762\u4ee5 Bash \u4e3a\u4f8b\u3002\\n\\n```bash\\n#\\n# Script: setup-spack.sh\\n#\\n#!/bin/bash\\nexport SPACK_ROOT=$HOME/public/spack\\nsource $SPACK_ROOT/share/spack/setup-env.sh\\n```\\n\\n\u968f\u540e\uff0c\u6211\u4eec\u5148\u7533\u8bf7\u4e00\u4e2a\u8ba1\u7b97\u8282\u70b9\uff0c\u540e\u7eed\u64cd\u4f5c\u90fd\u5728\u8ba1\u7b97\u8282\u70b9\u4e0a\u5b8c\u6210\u3002\\n\\n```bash\\n# \u7533\u8bf7\u8ba1\u7b97\u8282\u70b9\\n$ salloc -N 1 --exclusive -J spack\\n\\n# \u5047\u8bbe\u5206\u914d\u7684\u8282\u70b9\u540d\u4e3an0001\uff0c\u8fde\u63a5\u5230\u8be5\u8282\u70b9\u4e0a\\n$ ssh n0001\\n\\n# \u8bbe\u7f6e\u73af\u5883\u53d8\u91cf\\n$ source ./setup-spack.sh\\n```\\n\\n:::note\\n\u4f7f\u7528 Spack \u4e4b\u524d\uff0c\u6700\u597d\u786e\u4fdd\u7cfb\u7edf\u4e0a\u6709 Python 3.x\u3002\\n:::\\n\\n## \u4fee\u6539\u914d\u7f6e\u6587\u4ef6\u4e2d\u7684\u8def\u5f84\\n\\n\u9996\u5148\uff0c\u6211\u4eec\u8981\u4fee\u6539\u8f6f\u4ef6\u5b89\u88c5\u8def\u5f84\u3001mirror \u8def\u5f84\u548c repo \u8def\u5f84\u3002\\n\\n```bash\\n# \u4fee\u6539\u8f6f\u4ef6\u5b89\u88c5\u8def\u5f84\\n$ spack config edit config\\n\\nconfig:\\n  install_tree:\\n    root: ~/public/software/spack\\n\\n# \u589e\u52a0\u4f18\u5148\u641c\u7d22\u7684 mirror \u8def\u5f84\uff08\u9488\u5bf9\u4e0d\u80fd\u8054\u7f51\u7684\u673a\u5668\uff09\\n$ spack config edit mirrors\\n\\nmirrors:\\n  cluster-public: file://~/public/sources/spack\\n\\n# \u589e\u52a0\u4f18\u5148\u641c\u7d22\u7684 repo \u8def\u5f84\uff0c\u5982\u679c\u62f7\u8d1d\u81ea\u5b9e\u9a8c\u5ba4\u96c6\u7fa4\uff0c\u8981\u589e\u52a0 2 \u884c\\n$ spack config edit repos\\n\\nrepos:\\n  - ~/public/repos/spack/hpcde\\n  - ~/public/repos/spack/flipped\\n```\\n\\n## \u6dfb\u52a0\u7f16\u8bd1\u5668\\n\\n\u8d85\u7b97 S \u4e0a\u6709\u7cfb\u7edf\u81ea\u5e26\u7684\u7f16\u8bd1\u5668\uff0c\u4f4d\u4e8e `/usr` \u8def\u5f84\u3002\u5176\u4ed6\u7f16\u8bd1\u5668\u90fd\u7531\u7ba1\u7406\u5458\u5b89\u88c5\u5728\u522b\u7684\u8def\u5f84\uff0c\u8981\u7528 `module load` \u52a0\u8f7d\u3002\u6211\u4eec\u9996\u5148\u52a0\u8f7d\u7f16\u8bd1\u5668\uff0c\u518d\u8ba9 Spack \u6765\u641c\u7d22\u3002\\n\\n```bash\\n# \u52a0\u8f7d\u8d85\u7b97\u4e0a\u5e38\u7528\u7684\u7f16\u8bd1\u5668\\n$ module load compiler/gcc/10.2.0\\n\\n# \u67e5\u627e\u7f16\u8bd1\u5668\u5e76\u6dfb\u52a0\u5230\u914d\u7f6e\u6587\u4ef6\\n$ spack compiler find\\n\\n# \u6e05\u7a7a\u73af\u5883\uff0c\u9632\u6b62\u5e72\u6270\u540e\u7eed\u64cd\u4f5c\\n$ module purge\\n```\\n\\n\u6267\u884c\u5b8c\u6210\u540e\uff0c\u5e94\u8be5\u4f1a\u6709\u81f3\u5c11\u4e00\u4e2a\u7f16\u8bd1\u5668\u88ab\u6dfb\u52a0\u5230 `compilers.yaml` \u6587\u4ef6\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u53bb\u6389\u7cfb\u7edf\u81ea\u5e26\u7684\u4f4e\u7248\u672c\u7f16\u8bd1\u5668\uff0c\u53ea\u4fdd\u7559\u521a\u521a\u52a0\u8f7d\u7684\u90a3\u4e2a\u3002\\n\\n\u8d85\u7b97 S \u4e0a\u7684\u7f16\u8bd1\u5668\u53ef\u80fd\u9700\u8981\u4e00\u4e9b\u989d\u5916\u7684\u73af\u5883\u53d8\u91cf\u3001flags \u4e4b\u7c7b\uff0c\u6211\u4eec\u6709\u5fc5\u8981\u68c0\u67e5\u4e00\u4e0b\u539f\u672c\u7684\u6a21\u5757\u6587\u4ef6\u3002\\n\\n```bash\\n$ module show compiler/gcc/10.2.0\\n```\\n\\n\u82e5\u7684\u786e\u5b58\u5728\u73af\u5883\u53d8\u91cf\u3001flags\uff0c\u6211\u4eec\u8981\u628a\u5b83\u4eec\u6dfb\u52a0\u5230 `compilers.yaml` \u7684`environment` \u548c `flags` \u8fd9\u4e24\u4e2a\u5b57\u5178\u4e2d\u3002\\n\\n```bash\\n# \u7f16\u8f91\u914d\u7f6e\u6587\u4ef6\\n$ spack config edit compilers\\n\\n# \u82e5\u914d\u7f6e\u6587\u4ef6\u4e3a\u7a7a\u767d\uff0c\u53ef\u80fd\u662fscope\u7684\u4f18\u5148\u7ea7\u6709\u5f71\u54cd\uff0c\u53ef\u4ee5\u6307\u5b9ascope\\n# spack config --scope user compilers\\n```\\n\\n## \u6dfb\u52a0\u5916\u90e8\u8f6f\u4ef6\u5305\\n\\n\u8d85\u7b97 S \u4e0a\u6709\u4e00\u4e9b\u8f6f\u4ef6\u662f\u6211\u4eec\u65e0\u6cd5\u81ea\u5df1\u5b89\u88c5\u7684\uff0c\u4f8b\u5982\uff1a\\n\\n- `/usr` \u76ee\u5f55\u4e0b\u7684\u8f6f\u4ef6\u3002\u5b83\u4eec\u53ef\u80fd\u662f\u5176\u4ed6\u8f6f\u4ef6\u7684\u4f9d\u8d56\u9879\uff0c\u4e0d\u80fd\u968f\u610f\u66ff\u6362\uff1b\\n- `CUDA`\u3001`ROCM` \u7b49\u5e73\u53f0\u76f8\u5173\u7684\u8f6f\u4ef6\u3002\u5b83\u4eec\u7684\u5b89\u88c5\u6d89\u53ca\u786c\u4ef6\u578b\u53f7\u3001\u9a71\u52a8\u7248\u672c\uff0c\u81ea\u5df1\u5b89\u88c5\u975e\u5e38\u9ebb\u70e6\uff1b\\n- `PGI` \u7b49\u7f16\u8bd1\u5668\uff0c\u6216 `intel`\u3001`hpcx` \u7b49 MPI \u5b9e\u73b0\u3002\u5b83\u4eec\u90fd\u662f\u5546\u7528\u8f6f\u4ef6\uff0c\u5e76\u4e14\u53ef\u80fd\u7531\u7ba1\u7406\u5458\u5fae\u8c03\u8fc7\u3002\\n\\n\u603b\u4e4b\uff0c\u548c\u786c\u4ef6\u5173\u7cfb\u6bd4\u8f83\u5bc6\u5207\u7684\u8f6f\u4ef6\u90fd\u662f\u6211\u4eec\u8981\u907f\u514d\u91cd\u65b0\u5b89\u88c5\u7684\uff0c\u53ea\u80fd\u628a\u5b83\u4eec\u5f53\u4f5c\u5916\u90e8\u8f6f\u4ef6\u5305\u3002\\n\\n\u6dfb\u52a0\u5916\u90e8\u8f6f\u4ef6\u5305\u65f6\uff0c\u8981\u6ce8\u610f\u7528 `module show` \u6765\u67e5\u770b\u6a21\u5757\u6587\u4ef6\u7684\u914d\u7f6e\uff0c\u786e\u5b9a\u4e00\u4e2a\u8f6f\u4ef6\u6709\u54ea\u4e9b\u4f9d\u8d56\u3001\u73af\u5883\u53d8\u91cf\u9700\u8981\u8bbe\u7f6e\u3002\u6839\u636e\u6211\u4eec\u5047\u60f3\u7684\u8d85\u7b97 S \u914d\u7f6e\uff0c\u5916\u90e8\u8f6f\u4ef6\u5305\u5927\u6982\u6709\u4ee5\u4e0b\u51e0\u4e2a\uff1a\\n\\n```bash\\n$ spack config edit packages\\n\\npackages:\\n  gcc:\\n    buildable: false\\n    externals:\\n    - spec: gcc@10.2.0\\n      modules:\\n      - compiler/gcc/10.2.0\\n  mpi:\\n    buildable: false\\n  hpcx:\\n    buildable: false\\n    externals:\\n    - spec: hpcx@2.5%gcc@10.2.0\\n      modules:\\n      - compiler/gcc/10.2.0\\n      - mpi/hpcx/2.5\\n  cmake:\\n    buildable: false\\n    externals:\\n    - spec: cmake@3.19.3%gcc@10.2.0\\n      modules:\\n      - tools/cmake/3.19.3\\n  gettext:\\n    buildable: false\\n    externals:\\n    - spec: gettext@system\\n      prefix: /usr\\n  curl:\\n    buildable: false\\n    externals:\\n    - spec: curl@system\\n      prefix: /usr\\n  numactl:\\n    buildable: false\\n    externals:\\n    - spec: numactl@system\\n      prefix: /usr\\n  autoconf:\\n    buildable: false\\n    externals:\\n    - spec: autoconf@system\\n      prefix: /usr\\n  automake:\\n    buildable: false\\n    externals:\\n    - spec: automake@system\\n      prefix: /usr\\n  libtool:\\n    buildable: false\\n    externals:\\n    - spec: libtool@system\\n      prefix: /usr\\n  perl:\\n    buildable: false\\n    externals:\\n    - spec: perl@system\\n      prefix: /usr\\n  openssl:\\n    buildable: false\\n    externals:\\n    - spec: openssl@system\\n      prefix: /usr\\n  openssh:\\n    buildable: false\\n    externals:\\n    - spec: openssh@system\\n      prefix: /usr\\n  binutils:\\n    buildable: false\\n    externals:\\n    - spec: binutils@system+ld+libiberty~nls\\n      prefix: /usr\\n```\\n\\n\u4ece\u8fd9\u4e2a\u914d\u7f6e\u4e2d\u6211\u4eec\u53ef\u4ee5\u770b\u5230\uff0c\u6709\u4e00\u4e9b\u662f\u6211\u4eec\u7528 `modules` \u914d\u7f6e\u7684\uff0c\u5176\u4ed6\u90fd\u662f\u6211\u4eec\u4ece `/usr` \u8def\u5f84\u91cc\u627e\u7684\u3002\u5728 `/usr` \u8def\u5f84\u91cc\u7684\u8fd9\u4e9b\u90fd\u662f\u4e00\u4e9b\u6211\u4eec\u6ca1\u6709\u5fc5\u8981\u81ea\u5df1\u5b89\u88c5\uff0c\u6216\u8005\u81ea\u5df1\u5b89\u88c5\u5bb9\u6613\u51fa\u9519\u7684\u8f6f\u4ef6\uff0c\u4f8b\u5982\uff1a\\n\\n- `curl`\u3001`autoconf`\u3001`automake`\u3001`libtool`\u3001`perl` \u90fd\u662f\u6bd4\u8f83\u57fa\u672c\u7684\u5f00\u53d1\u5de5\u5177\uff0c\u4e0d\u9700\u8981\u5f88\u65b0\u7684\u7248\u672c\uff1b\\n- `gettext` \u662f\u7528\u4e8e\u672c\u5730\u5316\u7684\u8f6f\u4ef6\uff0c\u81ea\u5df1\u5b89\u88c5\u53ef\u80fd\u4f1a\u6709\u95ee\u9898\uff1b\\n- `openssl` \u662f\u7cfb\u7edf\u7684 SSL \u8f6f\u4ef6\uff0c\u81ea\u5df1\u5b89\u88c5\u53ef\u80fd\u4f1a\u6709\u95ee\u9898\uff1b\\n- `binutils` \u662f\u57fa\u672c\u7684 GNU \u5f00\u53d1\u5de5\u5177\uff0c\u5305\u62ec `ld`\u3001`ar` \u7b49\uff0c\u81ea\u5df1\u5b89\u88c5\u53ef\u80fd\u4f1a\u4e0e\u8d85\u7b97\u4e0a\u5176\u4ed6\u8f6f\u4ef6\u51b2\u7a81\u3002\u5728\u8fd9\u91cc\u4e3a\u4e86\u4fbf\u4e8e\u53d9\u8ff0\u6211\u4eec\u76f4\u63a5\u7ed9\u5b9a\u4e3a `system`\uff0c\u4f46\u901a\u5e38\u6211\u4eec\u5e94\u8be5\u7ed9\u5b9a\u7248\u672c\u53f7\u8ba9\u5176\u4ed6\u8f6f\u4ef6\u5305\u80fd\u6b63\u5e38\u5b89\u88c5\u3002\\n\\n:::tip \u7f3a\u5931\u7684\u8f6f\u4ef6\u5305\\n\\n\u76ee\u524d\u7684 Spack \u7248\u672c\uff080.16.0\uff09\u4e0d\u5305\u542b `hpcx` \u8fd9\u4e2a\u8f6f\u4ef6\u5305\uff0c\u6211\u4eec\u53ef\u4ee5\u81ea\u5b9a\u4e49\u4e00\u4e2a\u7b80\u5355\u7684 `hpcx` \u6765\u7528\u3002\u8be6\u89c1\u672c\u6587\u540e\u7eed\u8bf4\u660e\u3002\\n\\n:::\\n\\n## \u5b89\u88c5\u65b0\u7684\u8f6f\u4ef6\u5305\\n\\n\u5916\u90e8\u8f6f\u4ef6\u5305\u914d\u7f6e\u5b8c\u6210\u540e\uff0c\u6211\u4eec\u5df2\u7ecf\u5177\u5907\u5b89\u88c5\u65b0\u8f6f\u4ef6\u7684\u6240\u6709\u6761\u4ef6\u4e86\u3002\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u7528\u4e00\u4e2a\u811a\u672c\u6765\u6279\u91cf\u5b89\u88c5\u5982\u4e0b\u8f6f\u4ef6\uff1a\\n\\n- `netcdf-cxx4@4.3.1`\\n- `petsc@3.14.1`\\n- `python@3.7.9`\\n- `py-numpy@1.19.4`\\n- `scorep@6.0`\\n\\n\u5728\u5b89\u88c5\u5b83\u4eec\u7684\u8fc7\u7a0b\u4e2d\uff0c\u8fd8\u4f1a\u76f8\u5e94\u5730\u5b89\u88c5\u8bb8\u591a\u4f9d\u8d56\u3002\u5728\u4e0b\u9762\u7684\u811a\u672c\u4e2d\uff0c\u6211\u4eec\u628a\u5404\u7c7b\u4e0d\u540c\u7684\u8f6f\u4ef6\u5305\u90fd\u533a\u5206\u51fa\u6765\uff0c\u5206\u522b\u5b89\u88c5\u3002\\n\\n```bash\\n#!/bin/bash\\n\\n# \u5916\u90e8\u8f6f\u4ef6\u5305\uff0c\u5217\u51fa\u6765\u4fbf\u4e8e\u6211\u4eec\u5728\u6709\u95ee\u9898\u65f6\u9488\u5bf9\u6027\u5730\u8c03\u6574\\nexternals=(\\n    gcc\\n    hpcx\\n    cmake\\n\\n    autoconf\\n    automake\\n    binutils\\n    curl\\n    gettext\\n    libtool\\n    numactl\\n    openssl\\n    perl\\n)\\n\\n# \u7f57\u5217\u6211\u4eec\u8981\u5b89\u88c5\u7684\u8f6f\u4ef6\u5305\\ncompilers=(\'gcc@10.2.0\')\\ndevtools=(\\n    netcdf-cxx4@4.3.1\\n    petsc@3.14.1\\n    python@3.7.9\\n    py-numpy@1.19.4\\n    scorep@6.0\\n)\\n\\n# \u5b89\u88c5\u5916\u90e8\u8f6f\u4ef6\u5305\\nfor i in \\"${externals[@]}\\"\\ndo\\n    echo \\"external package: $i\\"\\n    spack install -ny --fail-fast $i\\ndone\\n\\n# \u5bf9\u4e8e\u6bcf\u4e2a\u5217\u51fa\u7684\u7f16\u8bd1\u5668\uff0c\u5b89\u88c5\u6211\u4eec\u9700\u8981\u7684\u8f6f\u4ef6\u5305\\nfor c in \\"${compilers[@]}\\"\\ndo\\n    for i in \\"${devtools[@]}\\"\\n    do\\n        echo \\"my package: $i%$c\\"\\n        spack install -ny --fail-fast $i%$c\\n    done\\ndone\\n```\\n\\n\u5728\u8fd9\u4e2a\u811a\u672c\u4e2d\uff0c\u6211\u4eec\u7528 `for` \u5faa\u73af\u6765\u9010\u4e2a\u5b89\u88c5\u8f6f\u4ef6\u5305\uff0c\u8fd9\u6837\u65b9\u4fbf\u6211\u4eec\u505a\u4e00\u4e9b\u989d\u5916\u7684\u64cd\u4f5c\uff08\u6bd4\u5982\u6253\u5370\u63d0\u793a\u4fe1\u606f\uff09\u3002\u6267\u884c\u5b8c\u6210\u540e\uff0c\u6240\u6709\u8f6f\u4ef6\u548c\u4f9d\u8d56\u90fd\u5df2\u6b63\u786e\u5b89\u88c5\uff0c\u6211\u4eec\u53ef\u4ee5\u9009\u62e9\u6e05\u7406\u4e0d\u5fc5\u8981\u7684\u6587\u4ef6\u3002\\n\\n```bash\\n# \u6e05\u7406\u53ef\u80fd\u5b58\u5728\u7684\u4e34\u65f6\u6587\u4ef6\\n$ spack clean\\n\\n# \u6e05\u7406\u4e0d\u5fc5\u8981\u7684\u4f9d\u8d56\u9879\\n$ spack gc\\n```\\n\\n## \u5bfc\u51fa\u6a21\u5757\u6587\u4ef6\\n\\n\u4f7f\u7528 Spack \u5b89\u88c5\u4e86\u8f6f\u4ef6\u5305\u540e\uff0c\u6211\u4eec\u8fd8\u53ea\u80fd\u7528 `spack load` \u52a0\u8f7d\u3002\u5728\u5b9e\u9a8c\u5ba4\u96c6\u7fa4\u6587\u6863\u4e2d\u6709\u63d0\u5230\uff0c\u8fd9\u79cd\u52a0\u8f7d\u65b9\u5f0f\u6bd4 `module load` \u8981\u6162\u5f88\u591a\uff0c\u4e14\u4e0e `module load` \u6df7\u7528\u5bb9\u6613\u51fa\u95ee\u9898\u3002\\n\\n\u7531\u4e8e\u6211\u4eec\u4e0d\u53ef\u907f\u514d\u5730\u8981\u4f7f\u7528\u8d85\u7b97 S \u4e0a\u7684 Environment Modules\uff0c\u6211\u4eec\u63a5\u4e0b\u6765\u628a\u521a\u521a\u5b89\u88c5\u7684\u6240\u6709\u8f6f\u4ef6\u5305\u90fd\u5bfc\u51fa\u4e3a\u6a21\u5757\u6587\u4ef6\u3002\u4e3a\u6b64\uff0c\u5148\u8c03\u6574\u914d\u7f6e\u6587\u4ef6\uff0c\u53ea\u5141\u8bb8\u4e00\u4e9b\u8f6f\u4ef6\u5305\u88ab\u5bfc\u51fa\u4e3a\u6a21\u5757\uff0c\u540c\u65f6\u4fee\u6539\u4e00\u4e0b\u6a21\u5757\u7684\u547d\u540d\u89c4\u5219\u3002\\n\\n```bash\\n$ spack config edit modules\\n\\nmodules:\\n  tcl:\\n    hash_length: 0\\n    verbose: True\\n    blacklist:\\n      - autoconf\\n      - automake\\n      - curl\\n      - gettext\\n      - libtool\\n      - numactl\\n      - openssl\\n      - openssh\\n      - perl\\n    all:\\n      conflict:\\n        - \'{name}\'\\n      environment:\\n        set:\\n          \'{name}_ROOT\': \'{prefix}\'\\n    projections:\\n      all:      \'{name}/{version}/{compiler.name}-{compiler.version}\'\\n      ^mpi:     \'{name}/{version}/{^mpi.name}-{^mpi.version}-{compiler.name}-{compiler.version}\'\\n    ^python:\\n      autoload: direct\\n```\\n\\n\u8be5\u914d\u7f6e\u6587\u4ef6\u4e2d\u5404\u5bf9\u8c61\u7684\u542b\u4e49\u5982\u4e0b\uff1a\\n\\n- `tcl`\uff1a\u8868\u793a\u6211\u4eec\u63a5\u4e0b\u6765\u7684\u914d\u7f6e\u90fd\u662f\u9488\u5bf9 Tcl \u6a21\u5757\u6587\u4ef6\u7684\uff1b\\n- `hash_length`\uff1a\u6a21\u5757\u6587\u4ef6\u540d\u79f0\u4e2d hash \u503c\u7684\u957f\u5ea6\uff1b\\n- `verbose`\uff1a\u5f53\u6a21\u5757\u6709 `autoload` \u6307\u5b9a\u7684\u4f9d\u8d56\u65f6\uff0c\u8f93\u51fa\u63d0\u793a\u4fe1\u606f\uff1b\\n- `blacklist`\uff1a\u7981\u6b62\u4e3a\u8fd9\u4e9b\u6a21\u5757\u751f\u6210\u6587\u4ef6\uff0c\u6211\u4eec\u628a `/usr` \u91cc\u627e\u5230\u7684\u90fd\u5c4f\u853d\u6389\uff1b\\n- `all`\uff1a\u5bf9\u6240\u6709 Tcl \u6a21\u5757\u751f\u6548\u7684\u8bbe\u7f6e\uff1b\\n- `conflict`\uff1a\u5728\u6a21\u5757\u6587\u4ef6\u4e2d\u589e\u52a0 `conflict`\uff1b\\n- `environment`\uff1a\u5728\u6a21\u5757\u6587\u4ef6\u4e2d\u8bbe\u7f6e\u7279\u5b9a\u73af\u5883\u53d8\u91cf\uff0c\u5728\u6b64\u6211\u4eec\u8bbe\u5b9a\u8bf8\u5982 `PETSC_ROOT` \u4e4b\u7c7b\u7684\u53d8\u91cf\uff1b\\n- `projections`\uff1a\u8c03\u6574\u8f6f\u4ef6\u5305\u5230\u6a21\u5757\u6587\u4ef6\u7684\u6620\u5c04\u89c4\u5219\uff1b\\n- `autoload`\uff1a\u6307\u660e\u6ee1\u8db3\u7279\u5b9a\u6761\u4ef6\u7684\u6a21\u5757\u9700\u8981\u52a0\u8f7d\u7684\u4f9d\u8d56\uff0c\u8fd9\u91cc\u6211\u4eec\u8ba9\u6240\u6709\u4f9d\u8d56\u4e8e `python` \u7684\u6a21\u5757\u90fd\u52a0\u8f7d\u4f9d\u8d56\u9879\u3002\\n\\n\u914d\u7f6e\u5b8c\u6210\u540e\uff0c\u6267\u884c\u547d\u4ee4\u6765\u751f\u6210\u6a21\u5757\u6587\u4ef6\uff1a\\n\\n```bash\\n# \u6e05\u7a7a\u4ee5\u524d\u7684\u6a21\u5757\u6587\u4ef6\uff0c\u751f\u6210\u65b0\u7684\u6a21\u5757\u6587\u4ef6\\n$ spack module tcl refresh --delete-tree\\n```\\n\\n\u968f\u540e\u4f7f\u7528\u547d\u4ee4\u6765\u542f\u7528 Spack \u6a21\u5757\u6587\u4ef6\u7684\u8def\u5f84\uff0c\u8be5\u8def\u5f84\u53ef\u4ee5\u5728 `config.yaml` \u4e2d\u4fee\u6539\u3002\u5728\u8fd9\u91cc\u6211\u4eec\u4f7f\u7528\u9ed8\u8ba4\u8def\u5f84\u3002\\n\\n```bash\\n# \u542f\u7528\u6a21\u5757\u641c\u7d22\u8def\u5f84\\n$ module use $SPACK_ROOT/share/spack/modules\\n\\n# \u5982\u679c\u8be5\u8def\u5f84\u5e95\u4e0b\u8fd8\u6709\u4ee5\u67b6\u6784\u547d\u540d\u7684\u76ee\u5f55\uff0c\u4e3a\u4e86\u907f\u514d\u6a21\u5757\u6587\u4ef6\u540d\u8fc7\u957f\uff0c\u6211\u4eec\u53ef\u4ee5\u7528\u4ee5\u4e0b\u547d\u4ee4\\n# module use $SPACK_ROOT/share/spack/modules/linux-centos7-x86_64\\n```\\n\\n\u6a21\u5757\u6587\u4ef6\u7684\u914d\u7f6e\u90fd\u5b8c\u6210\u540e\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u50cf\u52a0\u8f7d\u8d85\u7b97 S \u4e0a\u5df2\u6709\u7684\u6a21\u5757\u4e00\u6837\u52a0\u8f7d\u65b0\u5b89\u88c5\u7684\u6a21\u5757\u4e86\u3002\\n\\n## \u52a0\u8f7d\u6a21\u5757\\n\\n\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u7528 `module load` \u52a0\u8f7d\u6a21\u5757\uff0c\u4f46\u8fd9\u79cd\u65b9\u5f0f\u53ef\u80fd\u4f1a\u8ba9\u52a0\u8f7d\u7684\u6a21\u5757\u7f3a\u5c11\u4e00\u4e9b\u4f9d\u8d56\u3002Spack v0.16.0 \u8fd8\u4e0d\u80fd\u5f88\u597d\u5730\u5904\u7406\u6a21\u5757\u7684\u4f9d\u8d56\u5173\u7cfb\uff0c\u6211\u4eec\u8981\u4e48\u4fee\u6539 Spack \u7684\u6a21\u5757\u6587\u4ef6 `templates`\uff0c\u8981\u4e48\u5c31\u8ba9 Spack \u4e3a\u6211\u4eec\u751f\u6210\u52a0\u8f7d\u6a21\u5757\u7528\u7684\u547d\u4ee4\u3002\u8fd9\u91cc\u6211\u4eec\u9009\u62e9\u540e\u8005\u3002\\n\\n```bash\\n# \u751f\u6210\u4e00\u4e2a\u811a\u672c\uff0c\u5176\u4e2d\u4f1a\u5305\u542b\u5f88\u591amodule load\u547d\u4ee4\\n$ echo \'#!/bin/bash\' > env.sh\\n$ spack module tcl loads -r petsc py-numpy >> env.sh\\n$ chmod u+x env.sh\\n\\n# \u52a0\u8f7dpetsc\u548cpy-numpy\\n$ source ./env.sh\\n```\\n\\n## \u9644\uff1a\u81ea\u5b9a\u4e49\u8f6f\u4ef6\u5305\\n\\n\u5728\u6dfb\u52a0\u5916\u90e8\u8f6f\u4ef6\u5305\u6216\u8005\u5b89\u88c5\u65b0\u8f6f\u4ef6\u5305\u65f6\uff0c\u6211\u4eec\u53ef\u80fd\u4f1a\u9047\u5230 Spack \u4e0d\u80fd\u8bc6\u522b\u7684\u540d\u79f0\uff0c\u6bd4\u5982 `hpcx`\u3002\u9047\u5230\u8fd9\u79cd\u60c5\u51b5\u5927\u81f4\u6709\u4ee5\u4e0b\u51e0\u79cd\u5904\u7406\u65b9\u5f0f\uff1a\\n\\n- \u5b83\u53ef\u80fd\u53eb\u4e0d\u540c\u540d\u5b57\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 `spack list` \u6309\u901a\u914d\u7b26\u641c\u7d22\uff1b\\n- \u5728 Spack \u6587\u6863\u3001GitHub \u6216\u5176\u4ed6\u7f51\u7ad9\u4e0a\u641c\u7d22\u8be5\u8f6f\u4ef6\u5305\u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u627e\u5230\u4e86\u53ef\u4ee5\u76f4\u63a5\u7528\uff1b\\n- \u81ea\u5df1\u5b9a\u4e49\u8be5\u8f6f\u4ef6\u5305\u3002\\n\\n\u4e0b\u9762\u4ee5 `hpcx` \u4e3a\u4f8b\u6f14\u793a\u5982\u4f55\u81ea\u5b9a\u4e49\u8f6f\u4ef6\u5305\u5e76\u8bbe\u7f6e\u8fd0\u884c\u65f6\u7684\u73af\u5883\u53d8\u91cf\u3002\u5047\u8bbe\u8d85\u7b97 S \u4e0a\u5b89\u88c5\u7684 `hpcx` \u6709\u5982\u4e0b\u76ee\u5f55\u7ed3\u6784\uff1a\\n\\n```\\nhpcx/\\n|- gcc-10.2.0/\\n|- hcoll/\\n|- sharp/\\n`- ucx/\\n```\\n\\n\u7b80\u5355\u8d77\u89c1\uff0c\u6211\u4eec\u628a `hpcx` \u5f53\u4f5c\u57fa\u4e8e `openmpi` \u7684\u53e6\u4e00\u79cd `mpi`\uff0c\u5e76\u4e14\u4e0d\u8003\u8651\u5b83\u7684\u8bf8\u5982 `ucx`\u3001`hcoll` \u4e4b\u7c7b\u7684\u4f9d\u8d56\u9879\u3002\u8003\u8651\u5230\u6211\u4eec\u53ea\u60f3\u8981\u4e00\u4e2a\u5916\u90e8\u8f6f\u4ef6\u5305\uff0c\u4e0d\u4f1a\u76f4\u63a5 build \u5b83\uff0c\u6211\u4eec\u8981\u505a\u7684\u4e8b\u60c5\u53d8\u5f97\u5f88\u7b80\u5355\uff1a\\n\\n- \u521b\u5efa\u4e00\u4e2a\u540d\u4e3a `hpcx` \u7684 bundle package\uff1b\\n- \u5728 `package.py` \u4e2d\uff0c\u8ba9 `hpcx` \u4f9d\u8d56\u4e8e `openmpi`\uff0c\u5e76\u4e14\u63d0\u4f9b `mpi`\uff1b\\n- \u5728 `package.py` \u4e2d\uff0c\u8bbe\u7f6e build\u3001run \u7b49\u5404\u9636\u6bb5\u6240\u7528\u7684\u73af\u5883\u3002\\n\\n\u9996\u5148\u662f\u521b\u5efa\uff0c\u5728\u521b\u5efa\u65f6\u8981\u6307\u660e repo \u7684\u4f4d\u7f6e\u4ee5\u4fbf\u4e8e\u7edf\u4e00\u7ba1\u7406\uff1a\\n\\n```bash\\n$ spack create -r ~/public/repos/spack/ -t bundle -n hpcx\\n```\\n\\n\u63a5\u7740\u4fee\u6539 `package.py`\uff1a\\n\\n```python\\nfrom spack import *\\n\\nclass Hpcx(BundlePackage):\\n    \\"\\"\\"Mellanox HPC-X ScalableHPC Software Toolkit\\"\\"\\"\\n    homepage = \\"https://www.mellanox.com/products/hpc-x-toolkit\\"\\n    \\n    executables = [\'^ompi_info$\']\\n    \\n    version(\'2.4.1\')\\n\\n    provides(\'mpi\')\\n    provides(\'mpi@:3.0\', when=\'@2.0.0:\')\\n    depends_on(\'openmpi\')\\n    \\n    def setup_run_environment(self, env):\\n        import os\\n\\n        # Set user environment manually.\\n        hpcx_home       = os.path.dirname(self.prefix)\\n        hpcx_mpi_dir    = self.prefix\\n        hpcx_oshmem_dir = self.prefix\\n        hpcx_hcoll_dir  = join_path(hpcx_home, \'hcoll\')\\n        hpcx_sharp_dir  = join_path(hpcx_home, \'sharp\')\\n        hpcx_ucx_dir    = join_path(hpcx_home, \'ucx\')\\n\\n        for d in [hpcx_hcoll_dir, hpcx_sharp_dir, hpcx_ucx_dir]:\\n            env.prepend_path(\'PATH\',            join_path(d, \'bin\'))\\n            env.prepend_path(\'CPATH\',           join_path(d, \'include\'))\\n            env.prepend_path(\'LIBRARY_PATH\',    join_path(d, \'lib\'))\\n            env.prepend_path(\'LD_LIBRARY_PATH\', join_path(d, \'lib\'))\\n            \\n        # Dependency directories\\n        env.set(\'HPCX_HCOLL_DIR\', hpcx_hcoll_dir)\\n        env.set(\'HPCX_SHARP_DIR\', hpcx_sharp_dir)\\n        env.set(\'HPCX_UCX_DIR\',   hpcx_ucx_dir)\\n\\n        # Home directories\\n        homes = [\'HPCX_DIR\', \'HPCX_HOME\']\\n        for home in homes:\\n            env.set(home, hpcx_home)\\n\\n        mpi_homes = [\'HPCX_MPI_DIR\', \'HPCX_MPI_DIR\', \'OMPI_HOME\', \'MPI_HOME\']\\n        for mpi_home in mpi_homes:\\n            env.set(mpi_home, hpcx_mpi_dir)\\n\\n        oshmem_homes = [\'HPCX_OSHMEM_DIR\', \'OSHMEM_HOME\', \'SHMEM_HOME\']\\n        for oshmem_home in oshmem_homes:\\n            env.set(oshmem_home, hpcx_oshmem_dir)\\n\\n        # Because MPI is both a runtime and a compiler, we have to setup the\\n        # compiler components as part of the run environment.\\n        env.set(\'MPICC\',  join_path(self.prefix.bin, \'mpicc\'))\\n        env.set(\'MPICXX\', join_path(self.prefix.bin, \'mpic++\'))\\n        env.set(\'MPIF77\', join_path(self.prefix.bin, \'mpif77\'))\\n        env.set(\'MPIF90\', join_path(self.prefix.bin, \'mpif90\'))\\n\\n    def setup_dependent_build_environment(self, env, dependent_spec):\\n        # Duplicate environment variables to avoid Spack warnings.\\n        env.set(\'MPICC\',  join_path(self.prefix.bin, \'mpicc\'))\\n        env.set(\'MPICXX\', join_path(self.prefix.bin, \'mpic++\'))\\n        env.set(\'MPIF77\', join_path(self.prefix.bin, \'mpif77\'))\\n        env.set(\'MPIF90\', join_path(self.prefix.bin, \'mpif90\'))\\n\\n        # Use the spack compiler wrappers under MPI\\n        env.set(\'OMPI_CC\',  spack_cc)\\n        env.set(\'OMPI_CXX\', spack_cxx)\\n        env.set(\'OMPI_FC\',  spack_fc)\\n        env.set(\'OMPI_F77\', spack_f77)\\n\\n        # See https://www.open-mpi.org/faq/?category=building#installdirs\\n        for suffix in [\'PREFIX\', \'EXEC_PREFIX\', \'BINDIR\', \'SBINDIR\',\\n                       \'LIBEXECDIR\', \'DATAROOTDIR\', \'DATADIR\', \'SYSCONFDIR\',\\n                       \'SHAREDSTATEDIR\', \'LOCALSTATEDIR\', \'LIBDIR\',\\n                       \'INCLUDEDIR\', \'INFODIR\', \'MANDIR\', \'PKGDATADIR\',\\n                       \'PKGLIBDIR\', \'PKGINCLUDEDIR\']:\\n            env.unset(\'OPAL_%s\' % suffix)\\n\\n    def setup_dependent_package(self, module, dependent_spec):\\n        self.spec.mpicc  = join_path(self.prefix.bin, \'mpicc\')\\n        self.spec.mpicxx = join_path(self.prefix.bin, \'mpic++\')\\n        self.spec.mpifc  = join_path(self.prefix.bin, \'mpif90\')\\n        self.spec.mpif77 = join_path(self.prefix.bin, \'mpif77\')\\n        self.spec.mpicxx_shared_libs = [\\n            join_path(self.prefix.lib, \'libmpi_cxx.{0}\'.format(dso_suffix)),\\n            join_path(self.prefix.lib, \'libmpi.{0}\'.format(dso_suffix))\\n        ]\\n```\\n\\n\u5728\u8fd9\u4e2a\u914d\u7f6e\u6587\u4ef6\u4e2d\uff0c\u6211\u4eec\u589e\u52a0\u4e86\u4e00\u4e9b\u8bed\u53e5\u8ba9 `hpcx` \u80fd\u50cf `openmpi` \u4e00\u6837\u88ab\u4f7f\u7528\u3002\u5176\u4e2d\uff1a\\n\\n- `executables` \u7528\u4e8e\u63d0\u4f9b\u53ef\u6267\u884c\u6587\u4ef6\u8ba9 Spack \u80fd\u591f\u8bc6\u522b\uff1b\\n- `provides` \u7528\u4e8e\u63d0\u4f9b virtual package \u7ed9\u5176\u4ed6\u8f6f\u4ef6\u5305\u4f7f\u7528\uff1b\\n- `env` \u662f\u8868\u793a\u7528\u6237\u73af\u5883\u7684\u5bf9\u8c61\uff0c\u53ef\u4ee5\u64cd\u4f5c\u73af\u5883\u53d8\u91cf\uff1b\\n- `setup_run_environment` \u662f\u8bbe\u7f6e runtime \u73af\u5883\u7684\u65b9\u6cd5\uff0c\u5728\u52a0\u8f7d\u3001\u5378\u8f7d `hpcx` \u65f6\u4f1a\u88ab\u6267\u884c\uff1b\\n- `setup_dependent_build_environment` \u662f\u8bbe\u7f6e build-time \u73af\u5883\u7684\u65b9\u6cd5\uff0c\u4f1a\u5f71\u54cd\u4f9d\u8d56\u4e8e `hpcx` \u7684\u8f6f\u4ef6\u5305\uff1b\\n- `setup_dependent_package` \u4e5f\u662f\u8bbe\u7f6e build-time \u73af\u5883\u7684\u65b9\u6cd5\uff0c\u5f71\u54cd\u4f9d\u8d56\u4e8e `hpcx` \u7684\u8f6f\u4ef6\u5305\u3002\\n\\n\u5728 `setup_run_environment` \u4e2d\u6211\u4eec\u8bbe\u7f6e\u4e86\u5f88\u591a\u73af\u5883\u53d8\u91cf\uff0c\u5982\u679c\u8fd8\u6709\u5176\u4ed6\u4e0e\u8d85\u7b97 S \u7f51\u7edc\u76f8\u5173\u7684\u73af\u5883\u9700\u8981\u8bbe\u7f6e\uff0c\u4e5f\u53ef\u4ee5\u6dfb\u52a0\u5728\u8be5\u65b9\u6cd5\u4e2d\u3002\\n\\n:::note\\n\u8fd9\u91cc\u914d\u7f6e\u7684 `hpcx` \u662f\u7ed9\u5916\u90e8\u8f6f\u4ef6\u5305\u4f7f\u7528\u7684\uff0c\u6240\u4ee5\u91cc\u9762\u6ca1\u6709\u7ed9\u5b9a\u5176\u4ed6\u4f9d\u8d56\u9879\u3002\\n:::"},{"id":"one-terminal-multiplexers","metadata":{"permalink":"/cluster-docs/blog/one-terminal-multiplexers","editUrl":"https://github.com/hpcde/cluster-docs/blob/master/blog/2020-12-12-one-terminal-multiplexers.md","source":"@site/blog/2020-12-12-one-terminal-multiplexers.md","title":"\u5b9e\u7528\u5de5\u5177\uff1aTerminal Multiplexers","description":"\u4f7f\u7528\u5b9e\u9a8c\u5ba4\u96c6\u7fa4\u65f6\uff0c\u6211\u4eec\u53ef\u80fd\u5076\u5c14\u4f1a\u9047\u5230\u65ad\u5f00\u8fde\u63a5\u7684\u60c5\u51b5\uff0c\u53ef\u80fd\u662f\u4e3b\u52a8\u65ad\u5f00SSH\uff0c\u4e5f\u53ef\u80fd\u662f\u7f51\u7edc\u4e0d\u7a33\u5b9a\u3002\u65e0\u8bba\u600e\u6837\uff0c\u91cd\u65b0\u8fde\u63a5\u540e\u4e0d\u4f1a\u81ea\u52a8\u6062\u590d\u4e0a\u4e00\u6b21\u7684\u5de5\u4f5c\uff08\u6240\u5728\u7684\u8def\u5f84\u3001\u73af\u5883\u53d8\u91cf\u3001\u6253\u5f00\u7684\u6587\u4ef6\u7b49\uff09\u3002","date":"2020-12-12T00:00:00.000Z","formattedDate":"December 12, 2020","tags":[{"label":"tool","permalink":"/cluster-docs/blog/tags/tool"},{"label":"screen","permalink":"/cluster-docs/blog/tags/screen"},{"label":"tmux","permalink":"/cluster-docs/blog/tags/tmux"}],"readingTime":8.375,"truncated":true,"authors":[{"name":"one","title":"PhD student at USTB","url":"https://github.com/alephpiece","imageURL":"https://github.com/alephpiece.png"}],"frontMatter":{"slug":"one-terminal-multiplexers","title":"\u5b9e\u7528\u5de5\u5177\uff1aTerminal Multiplexers","author":"one","author_title":"PhD student at USTB","author_url":"https://github.com/alephpiece","author_image_url":"https://github.com/alephpiece.png","tags":["tool","screen","tmux"]},"prevItem":{"title":"\u5982\u4f55\u5728\u8d85\u7b97\u4e0a\u914d\u7f6eSpack","permalink":"/cluster-docs/blog/one-spack-on-supercomputers"},"nextItem":{"title":"\u4f7f\u7528\u96c6\u7fa4\u4e0a\u5b89\u88c5\u7684BOUT++\u5e93","permalink":"/cluster-docs/blog/one-bout-dev-usage"}},"content":"\u4f7f\u7528\u5b9e\u9a8c\u5ba4\u96c6\u7fa4\u65f6\uff0c\u6211\u4eec\u53ef\u80fd\u5076\u5c14\u4f1a\u9047\u5230\u65ad\u5f00\u8fde\u63a5\u7684\u60c5\u51b5\uff0c\u53ef\u80fd\u662f\u4e3b\u52a8\u65ad\u5f00SSH\uff0c\u4e5f\u53ef\u80fd\u662f\u7f51\u7edc\u4e0d\u7a33\u5b9a\u3002\u65e0\u8bba\u600e\u6837\uff0c\u91cd\u65b0\u8fde\u63a5\u540e\u4e0d\u4f1a\u81ea\u52a8\u6062\u590d\u4e0a\u4e00\u6b21\u7684\u5de5\u4f5c\uff08\u6240\u5728\u7684\u8def\u5f84\u3001\u73af\u5883\u53d8\u91cf\u3001\u6253\u5f00\u7684\u6587\u4ef6\u7b49\uff09\u3002\\n\\n\u4e3a\u4e86\u4fdd\u5b58\u5de5\u4f5c\uff0c\u4fbf\u4e8e\u91cd\u8fde\u540e\u7ee7\u7eed\uff0c\u6211\u4eec\u53ef\u4ee5\u8ba9\u81ea\u5df1\u7684\u7a0b\u5e8f\u6216\u8005 shell \u5728\u540e\u53f0\u4e00\u76f4\u8fd0\u884c\u3002\u4fdd\u6301\u7a0b\u5e8f\u540e\u53f0\u8fd0\u884c\u7684\u65b9\u5f0f/\u5de5\u5177\u6709\u5f88\u591a\uff0c\u672c\u6587\u7b80\u5355\u4ecb\u7ecd\u4ee5\u4e0b\u51e0\u79cd\uff1a\\n\\n- `nohup` \u548c `&`\\n- `screen`\\n- `tmux`\\n\\n\x3c!--truncate--\x3e\\n\\n## \u540e\u53f0\u8fd0\u884c\u7a0b\u5e8f\uff1anohup \u548c &\\n\\n\u53c2\u8003\uff1a\\n\\n- [Wikipedia - nohup](https://en.wikipedia.org/wiki/Nohup)\\n\\nLinux\u4e0a\u5e38\u7528\u7684\u540e\u53f0\u6267\u884c\u7a0b\u5e8f\u7684\u547d\u4ee4\u662f `nohup`\uff0c\u5b83\u7684\u529f\u80fd\u662f\u65e0\u89c6 hangup \u4fe1\u53f7\uff0c\u4e5f\u5c31\u662f\u5728 shell \u9000\u51fa\u65f6\u4e0d\u4f1a\u81ea\u52a8\u88ab\u6302\u65ad\u3002\u8be5\u547d\u4ee4\u9ed8\u8ba4\u4f1a\u628a\u539f\u672c\u5230\u6807\u51c6\u8f93\u51fa\u7684\u4e1c\u897f\u91cd\u5b9a\u5411\u5230\u4e00\u4e2a\u6587\u4ef6\u3002\\n\\n```bash\\n$ nohup ping nodedata\\nnohup: ignoring input and appending output to \u2018nohup.out\u2019\\n```\\n\\n\u6267\u884c\u8be5\u547d\u4ee4\u540e\uff0c\u9000\u51fa shell \u4e0d\u4f1a\u4e2d\u65ad\u5b83\u3002\u5b9e\u9645\u4e0a\uff0c\u5b83\u5df2\u7ecf\u4e0d\u518d\u4f9d\u8d56\u4e8e\u4efb\u4f55 pts \u4e86\u3002\u4e0d\u8fc7\uff0c\u6211\u4eec\u76f4\u63a5\u5728\u5f53\u524dshell\u6267\u884c\u540e\uff08*foreground*\uff09\uff0c\u628a\u81ea\u5df1\u7684 shell \u4e5f\u963b\u585e\u4e86\uff0c\u56e0\u6b64\u6211\u4eec\u8981\u628a\u7a0b\u5e8f\u653e\u5728\u540e\u53f0\uff08*background*\uff09\u3002\\n\\n```bash\\n$ ping nodedata &\\n```\\n\\n\u6267\u884c\u8be5\u547d\u4ee4\u540e\uff0c\u4f1a\u4ea7\u751f\u4e00\u4e2a subshell \u6765\u6267\u884c `ping nodedata`\uff0c\u8f93\u51fa\u4ecd\u7136\u662f\u6807\u51c6\u8f93\u51fa\uff0c\u6240\u4ee5\u4f1a\u51fa\u73b0\u8fd9\u6837\u7684\u60c5\u51b5\uff1a\u5c4f\u5e55\u4e0d\u65ad\u5730\u6253\u5370\u4e1c\u897f\u51fa\u6765\uff0c\u4f46\u81ea\u5df1\u8fd8\u662f\u80fd\u6b63\u5e38\u6572\u5176\u4ed6\u547d\u4ee4\u3002\\n\\n\u4f5c\u4e3a\u540e\u53f0\u8fd0\u884c\u7684\u8fdb\u7a0b\uff0c\u76f4\u63a5\u7528\u7ec4\u5408\u952e `Control + c` \u662f\u65e0\u6cd5\u7ec8\u6b62\u7684\u3002\u901a\u5e38\u6709\u4e24\u79cd\u65b9\u6cd5\u7528\u4e8e\u7ec8\u6b62\u4e00\u4e2a\u540e\u53f0\u6267\u884c\u7684\u7a0b\u5e8f\uff1a\\n\\n- \u7528 `ps` \u627e\u5230\u8fdb\u7a0b\u53f7\uff0c\u7528 `kill` \u76f4\u63a5\u53d1\u9001\u7ec8\u6b62\u4fe1\u53f7\uff1b\\n- \u7528 `fg` \u628a\u540e\u53f0\u7a0b\u5e8f\u8c03\u5230\u5230\u524d\u9762\uff0c\u518d `Control + c` \u7ec8\u6b62\u3002\\n\\n\u4e86\u89e3 `nohup` \u548c `&` \u4ee5\u540e\uff0c\u6211\u4eec\u53ef\u4ee5\u7ec4\u5408\u4e24\u8005\uff0c\u5b9e\u73b0\u540e\u53f0\u8fd0\u884c\u4e00\u4e2a\u4e0d\u4f9d\u8d56\u4e8e\u5f53\u524d shell \u7684\u7a0b\u5e8f\u3002\\n\\n```bash\\n$ nohup ping nodedata &\\n```\\n\\n\u6267\u884c\u8be5\u547d\u4ee4\u540e\uff0c\u4ecd\u7136\u53ef\u4ee5\u5728\u5f53\u524dshell\u505a\u5176\u4ed6\u4e8b\u60c5\uff0c\u56e0\u4e3a `&` \u628a\u7a0b\u5e8f\u8f6c\u5165\u540e\u53f0\uff0c\u800c `nohup` \u91cd\u5b9a\u5411\u4e86\u8f93\u51fa\u3002\u4e5f\u53ef\u4ee5\u7acb\u9a6c\u9000\u51fa\uff0c\u56e0\u4e3a `nohup` \u4f1a\u65e0\u89c6SIGHUP\u4fe1\u53f7\u3002\\n\\n## Terminal multiplexers\\n\\n\u53c2\u8003\uff1a\\n\\n- [Wikipedia - Terminal multiplexer](https://en.wikipedia.org/wiki/Terminal_multiplexer)\\n\\n\u7ec8\u7aef\u591a\u8def\u590d\u7528\u5668\uff08terminal multiplexers\uff09\u5c31\u662f\u4e00\u79cd\u521b\u5efa\u591a\u4e2a\u4f2a\u7ec8\u7aef\uff08\u4f1a\u8bdd\uff09\u7684\u7a0b\u5e8f\uff0c\u8fbe\u5230\u7c7b\u4f3c\u4e8e\u201c\u591a\u8def\u590d\u7528\u201d\u7684\u72b6\u6001\u3002\u76f8\u6bd4\u4e8e `nohup` \u901a\u5e38\u53ea\u7528\u4e8e\u8dd1\u5355\u4e2a\u7a0b\u5e8f\uff0c\u6211\u4eec\u4f7f\u7528 multiplexer \u53ef\u4ee5\u5f88\u5bb9\u6613\u5730\u5728\u4e00\u4e2a\u767b\u5f55\u7684\u7ec8\u7aef\u4e2d\u7ba1\u7406\u5927\u91cf\u4f1a\u8bdd\uff0c\u6bcf\u4e2a\u4f1a\u8bdd\u90fd\u6709\u81ea\u5df1\u7684shell\u3002\\n\\n\u4e00\u4e2a\u4f1a\u8bdd\u901a\u5e38\u6709 *attached* \u548c *detached* \u4e24\u79cd\u72b6\u6001\uff0cattached \u8868\u793a\u6709\u67d0\u4e2a shell \u6b63\u5728\u4f7f\u7528\u5b83\uff08\u53ef\u4ee5\u540c\u65f6\u4ece\u591a\u4e2a shell \u8fdb\u5165\u540c\u4e00\u4f1a\u8bdd\uff09\uff0cdetached \u8868\u793a\u5b83\u6ca1\u88ab\u4f7f\u7528\u3002\\n\\n\u5904\u4e8e\u4e00\u4e2a\u4f1a\u8bdd\u4e2d\u65f6\uff0c\u901a\u5e38\u8981\u4f7f\u7528\u7ec4\u5408\u952e\u6765\u5411 multiplexer \u53d1\u9001\u547d\u4ee4\uff0c\u89c1\u540e\u7eed\u4ecb\u7ecd\u3002\u5728\u4f1a\u8bdd\u4e2d\uff0c\u7528\u6237\u53ef\u4ee5\u4f7f\u7528\u7684\u7ec4\u5408\u952e\u901a\u5e38\u90fd\u975e\u5e38\u4e30\u5bcc\uff0c\u53ef\u4ee5\u5b9e\u73b0\u5728\u540c\u4e00\u4f1a\u8bdd\u4e2d\u521b\u5efa\u591a\u4e2a\u7a97\u53e3\u3001\u5206\u5c4f\u7b49\u64cd\u4f5c\u3002\\n\\n### screen\\n\\n`screen` \u662fLinux\u901a\u5e38\u4f1a\u5e26\u7684 multiplexer\u3002\u521b\u5efa\u5e76\u8fdb\u5165\u4f1a\u8bdd\u540e\uff0c\u6240\u6709\u53d1\u7ed9 `screen` \u7684\u547d\u4ee4\u90fd\u7531\u7ec4\u5408\u952e `Control + a` \u5f00\u5934\u3002\u4f8b\u5982\uff1a\\n\\n| \u7ec4\u5408\u952e          | \u529f\u80fd                                     |\\n| --------------- | ---------------------------------------- |\\n| Control + a + ? | \u67e5\u770b\u5728`screen`\u4f1a\u8bdd\u4e2d\u53ef\u4f7f\u7528\u7684key bindings |\\n| Control + a + d | detach\uff0c\u628a\u5f53\u524d\u4f1a\u8bdd\u6302\u5728\u540e\u53f0               |\\n\\n\u5b9e\u9645\u64cd\u4f5c\u7684\u4f8b\u5b50\u5982\u4e0b\uff1a\\n\\n```bash\\n## \u4ee5detached\u6a21\u5f0f\u521b\u5efa\u4e00\u4e2a\u6709\u540d\u5b57\u7684\u4f1a\u8bdd\\n$ screen -dmS test\\n\\n## \u521b\u5efa\u53e6\u4e00\u4e2a\u6709\u540d\u5b57\u7684\u4f1a\u8bdd\uff0c\u5e76\u7acb\u5373\u4f7f\u7528\uff08attach\uff09\\n$ screen -S develop\\n\\n## \u5217\u51fa\u6240\u6709\u5b58\u5728\u7684\u4f1a\u8bdd\u548c\u72b6\u6001\\n$ screen -ls\\nThere are screens on:\\n        26426.develop   (Attached)\\n        26348.test      (Detached)\\n2 Sockets in /var/run/screen/S-one.\\n\\n## detach\u5f53\u524d\u4f1a\u8bdd\uff0c\u9000\u56de\u5230\u6700\u521d\u7684shell\\nControl + a + d\\n\\n## \u8fdb\u5165\u53e6\u4e00\u4e2a\u4f1a\u8bdd\uff08reattach\uff09\\n$ screen -r test\\n\\n## \u5047\u8bbe\u7f51\u7edc\u7a81\u7136\u4e2d\u65ad\uff0c\u53c8\u6216\u8005\u6211\u4eec\u60f3\u5728\u53e6\u4e00\u53f0\u7535\u8111\u4e0a\u7ee7\u7eed\u4e4b\u524d\u7684\u5de5\u4f5c\\n## \u53ea\u9700\u8981\u767b\u5f55\u540e\u6267\u884c\\n$ screen -r develop\\n```\\n\\n### tmux\\n\\n\u53c2\u8003\uff1a\\n\\n- [Tmux Wiki](https://github.com/tmux/tmux/wiki)\\n\\n- [Tmux Cheat Sheet & Quick Reference](https://tmuxcheatsheet.com/)\\n\\n`tmux` \u662f\u4e00\u4e2a\u6bd4 `screen` \u529f\u80fd\u66f4\u5168\u9762\u7684 multiplexer\uff0c\u4f46\u5b83\u4eec\u7684\u57fa\u672c\u7528\u6cd5\u5dee\u4e0d\u591a\u3002\u521b\u5efa\u5e76\u8fdb\u5165\u4f1a\u8bdd\u540e\uff0c\u6240\u6709\u53d1\u7ed9 `screen` \u7684\u547d\u4ee4\u90fd\u7531\u7ec4\u5408\u952e `Control + b` \u5f00\u5934\u3002\u4f8b\u5982\uff1a\\n\\n| \u7ec4\u5408\u952e            | \u529f\u80fd                                               |\\n| ----------------- | -------------------------------------------------- |\\n| Control + b + ?   | \u67e5\u770b\u5728`tmux`\u4f1a\u8bdd\u4e2d\u53ef\u4f7f\u7528\u7684key bindings\u548c\u547d\u4ee4       |\\n| Control + b + d   | detach\uff0c\u628a\u5f53\u524d\u4f1a\u8bdd\u6302\u5728\u540e\u53f0                         |\\n| Control + b + :   | \u53d1\u9001\u547d\u4ee4\u5230`tmux`\uff0c\u6bcf\u4e2a\u7ec4\u5408\u952e\u7684\u529f\u80fd\u90fd\u53ef\u4ee5\u7528\u547d\u4ee4\u5b8c\u6210 |\\n| Control + b + c   | \u5728\u5f53\u524d\u4f1a\u8bdd\u521b\u5efa\u65b0\u7684window                           |\\n| Control + b + n/p | \u5207\u6362\u5230\u524d\u4e00\u4e2a/\u540e\u4e00\u4e2awindow                          |\\n| Control + b + w   | \u5217\u51fa\u73b0\u5b58\u7684windows\uff0c\u53ef\u7528\u952e\u76d8\u4e0a/\u4e0b\u952e\u9009\u62e9             |\\n\\n\u5b9e\u9645\u64cd\u4f5c\u7684\u4f8b\u5b50\u5982\u4e0b\uff1a\\n\\n```bash\\n## \u4ee5detached\u6a21\u5f0f\u521b\u5efa\u4e00\u4e2a\u6709\u540d\u5b57\u7684\u4f1a\u8bdd\\n$ tmux new-session -ds test\\n\\n## \u521b\u5efa\u53e6\u4e00\u4e2a\u6709\u540d\u5b57\u7684\u4f1a\u8bdd\uff0c\u5e76\u7acb\u5373\u4f7f\u7528\uff08attach\uff09\\n$ tmux new-session -s develop\\n\\n## \u5217\u51fa\u6240\u6709\u5b58\u5728\u7684\u4f1a\u8bdd\u548c\u72b6\u6001\\n$ tmux ls\\ntest: 1 windows\\ndevelop: 1 windows (attached)\\n\\n## detach\u5f53\u524d\u4f1a\u8bdd\uff0c\u9000\u56de\u5230\u6700\u521d\u7684shell\\nControl + b + d\\n\\n## \u8fdb\u5165\u53e6\u4e00\u4e2a\u4f1a\u8bdd\uff08reattach\uff09\\n$ tmux attach -t test\\n\\n## \u5047\u8bbe\u7f51\u7edc\u7a81\u7136\u4e2d\u65ad\uff0c\u53c8\u6216\u8005\u6211\u4eec\u60f3\u5728\u53e6\u4e00\u53f0\u7535\u8111\u4e0a\u7ee7\u7eed\u4e4b\u524d\u7684\u5de5\u4f5c\\n## \u53ea\u9700\u8981\u767b\u5f55\u540e\u6267\u884c\\n$ tmux attach -t develop\\n```\\n\\n## \u4fdd\u6301SSH\u6216SFTP\u8fde\u63a5\\n\\n\u5f53\u6211\u4eec\u4f7f\u7528\u96c6\u7fa4\u65f6\uff0c\u4f7f\u7528 `screen` \u6216 `tmux` \u8fd9\u6837\u7684\u7a0b\u5e8f\u80fd\u8ba9\u6211\u4eec\u4fdd\u5b58\u5f53\u524d\u7684\u5de5\u4f5c\u4ee5\u4fbf\u4e0b\u6b21\u7ee7\u7eed\u3002\u5982\u679c\u51fa\u4e8e\u67d0\u79cd\u7406\u7531\u6211\u4eec\u4e0d\u5e0c\u671b\u53cd\u590d\u767b\u5f55\u96c6\u7fa4\uff08\u6bd4\u5982\u9700\u8981\u52a8\u6001\u53e3\u4ee4\uff09\uff0c\u90a3\u5c31\u9700\u8981\u4fdd\u5b58\u5df2\u767b\u5f55\u7684 shell\uff0c\u4e5f\u5c31\u662f\u5728 multiplexer \u6253\u5f00\u7684\u4f1a\u8bdd\u91cc\u9762\u767b\u5f55\u96c6\u7fa4\u3002\\n\\n\u4f8b\u5982\uff0c\u6211\u4eec\u60f3\u5728\u5b9e\u9a8c\u5ba4\u673a\u5668\u4e0a\u521b\u5efa\u4f1a\u8bdd\uff0c\u5728\u8fd9\u4e2a\u4f1a\u8bdd\u91cc\u9762\u6253\u5f00\u4e00\u4e2aSSH\u548c\u4e00\u4e2aSFTP\u5230\u67d0\u8d85\u7b97S\u3002\u5047\u8bbe\u8d85\u7b97\u57df\u540d\u662f `s.example.cn`\uff0c\u7aef\u53e3\u662f `12345`\uff0c\u6211\u7684\u7528\u6237\u540d\u662f `hpcer`\u3002\\n\\n```bash\\n## \u9996\u5148\u4ece\u81ea\u5df1\u7535\u8111\u767b\u5f55\u5b9e\u9a8c\u5ba4\u96c6\u7fa4\\n$ ssh hpcer@ssh.hpcer.dev\\n\\n## \u521b\u5efa\u4e00\u4e2atmux\u4f1a\u8bdd\u7528\u4e8eSSH\\n$ tmux new-session -s myssh\\n\\n## \u5728myssh\u4f1a\u8bdd\u4e2d\u8fde\u63a5\u8d85\u7b97S\\n$ ssh -o ServerAliveInterval=60 -p 12345 hpcer@s.example.cn\\n\\n## \u7528\u7ec4\u5408\u952edetach\u5f53\u524d\u4f1a\u8bdd\\nControl + b + d\\n\\n## \u521b\u5efa\u53e6\u4e00\u4e2atmux\u4f1a\u8bdd\u7528\u4e8eSFTP\\n$ tmux new-session -s mysftp\\n\\n## \u5728mysftp\u4f1a\u8bdd\u4e2d\u8fde\u63a5\u8d85\u7b97S\\n$ sftp -o ServerAliveInterval=60 -P 12345 hpcer@s.example.cn\\n\\n## \u7528\u7ec4\u5408\u952edetach\u5f53\u524d\u4f1a\u8bdd\\nControl + b + d \\n```\\n\\n\u521b\u5efa\u4e86\u4e0a\u8ff0\u4e24\u4e2a\u4f1a\u8bdd\u540e\uff0c\u53ea\u8981\u5b9e\u9a8c\u5ba4\u96c6\u7fa4\u5230\u8d85\u7b97S\u7684\u8fde\u63a5\u4e0d\u65ad\u5f00\uff0c\u6211\u4eec\u968f\u65f6\u90fd\u53ef\u4ee5\u901a\u8fc7 `tmux` \u4f1a\u8bdd\u56de\u5230\u8d85\u7b97S\uff0c\u4e0d\u9700\u8981\u53cd\u590d\u767b\u5f55\u3002\u5982\u679c\u5b9e\u9a8c\u5ba4\u96c6\u7fa4\u5230\u8d85\u7b97S\u7684\u8fde\u63a5\u4e5f\u4e0d\u7a33\u5b9a\uff0c\u53ef\u4ee5\u6362\u5176\u4ed6\u4e0d\u5728\u6821\u56ed\u7f51\u7684\u673a\u5668\u3002"},{"id":"one-bout-dev-usage","metadata":{"permalink":"/cluster-docs/blog/one-bout-dev-usage","editUrl":"https://github.com/hpcde/cluster-docs/blob/master/blog/2020-12-11-one-bout-dev-usage.md","source":"@site/blog/2020-12-11-one-bout-dev-usage.md","title":"\u4f7f\u7528\u96c6\u7fa4\u4e0a\u5b89\u88c5\u7684BOUT++\u5e93","description":"\u672c\u6587\u6f14\u793a\u4e86\u5982\u4f55\u4f7f\u7528\u5b9e\u9a8c\u5ba4\u96c6\u7fa4\u4e0a\u5b89\u88c5\u7684BOUT++\u3002","date":"2020-12-11T00:00:00.000Z","formattedDate":"December 11, 2020","tags":[{"label":"tutorial","permalink":"/cluster-docs/blog/tags/tutorial"},{"label":"bout++","permalink":"/cluster-docs/blog/tags/bout"},{"label":"spack","permalink":"/cluster-docs/blog/tags/spack"}],"readingTime":3.845,"truncated":true,"authors":[{"name":"one","title":"PhD student at USTB","url":"https://github.com/alephpiece","imageURL":"https://github.com/alephpiece.png"}],"frontMatter":{"slug":"one-bout-dev-usage","title":"\u4f7f\u7528\u96c6\u7fa4\u4e0a\u5b89\u88c5\u7684BOUT++\u5e93","author":"one","author_title":"PhD student at USTB","author_url":"https://github.com/alephpiece","author_image_url":"https://github.com/alephpiece.png","tags":["tutorial","bout++","spack"]},"prevItem":{"title":"\u5b9e\u7528\u5de5\u5177\uff1aTerminal Multiplexers","permalink":"/cluster-docs/blog/one-terminal-multiplexers"},"nextItem":{"title":"\u5207\u6362Spack\u73af\u5883\u53d8\u91cf","permalink":"/cluster-docs/blog/one-reset-spack-env"}},"content":"\u672c\u6587\u6f14\u793a\u4e86\u5982\u4f55\u4f7f\u7528\u5b9e\u9a8c\u5ba4\u96c6\u7fa4\u4e0a\u5b89\u88c5\u7684BOUT++\u3002\\n\\n\u4f7f\u7528\u5df2\u5b89\u88c5\u7684\u67d0\u7248\u672cBOUT++\u5e93\uff1a\\n\\n```bash\\n$ spack load bout-dev ~openmp+scorep\\n```\\n\\n\u4f7f\u7528BOUT++\u7684\u4f9d\u8d56\uff0c\u4f46\u4e0d\u5305\u62ecBOUT++\u5e93\u672c\u8eab\uff1a\\n\\n```bash\\n$ spack load --only dependencies ~openmp+scorep\\n```\\n\\n\u67e5\u770b\u5f53\u524dBOUT++\u7684\u914d\u7f6e\uff1a\\n```bash\\n$ bout-config --all\\n```\\n\\n\x3c!--truncate--\x3e\\n\\n## \u94fe\u63a5\u96c6\u7fa4\u4e0a\u5df2\u5b89\u88c5\u7684BOUT++\u5e93\\n\\nBOUT++\u901a\u5e38\u9700\u8981\u5f00\u53d1\u8005\u5728\u6e90\u4ee3\u7801\u76ee\u5f55\u4e0b\u7f16\u8bd1\uff0c\u4e5f\u5c31\u662f*in-source build*\u3002\u5b8c\u6210build\u540e\u6709\u4ee5\u4e0b\u51e0\u4e2a\u6bd4\u8f83\u91cd\u8981\u7684\u6587\u4ef6\uff1a\\n\\n- `lib/libbout++.a`\uff1aBOUT++\u7684\u9759\u6001\u5e93\uff0c\u9ed8\u8ba4\u662f\u6ca1\u6709\u5171\u4eab\u5e93\u7684\uff1b\\n- `bin/bout-config`\uff1a\u6253\u5370BOUT++\u914d\u7f6e\u4fe1\u606f\u7684\u811a\u672c\uff0c\u6bd4\u5982\u5e93\u7684\u8def\u5f84\u3001\u7f16\u8bd1\u5668\u8def\u5f84\u7b49\uff1b\\n- `make.config`\uff1a\u7f16\u8bd1BOUT++\u7b97\u4f8b\u7528\u7684makefile\uff0c\u5305\u542b\u5934\u6587\u4ef6\u548c\u5e93\u8def\u5f84\u3001\u7f16\u8bd1flags\u7b49\u3002\\n\\n\u968f\u540e\u6211\u4eec\u53ef\u4ee5\u8fdb\u5230\u7b97\u4f8b\u7684\u76ee\u5f55\u4e0b\uff0c\u76f4\u63a5\u8c03`make`\u6765\u7f16\u8bd1\u7b97\u4f8b\u5f97\u5230\u53ef\u6267\u884c\u6587\u4ef6\uff0c\u4f8b\u5982\\n\\n```bash\\n$ cd examples/conduction\\n$ make\\n```\\n\\n\u7b97\u4f8b\u76ee\u5f55\u4e0b\u7684makefile\u4f1a\u5c06BOUT++\u7684\u6839\u76ee\u5f55`BOUT_TOP`\u8bbe\u7f6e\u4e3a\u5f53\u524d\u6e90\u4ee3\u7801\u7684\u6839\u76ee\u5f55\uff0c\u7136\u540e\u8c03`make.config`\u5b8c\u6210\u540e\u7eed\u5de5\u4f5c\u3002\\n\\n`make.config`\u4e2d\u7684\u5173\u952e\u53d8\u91cf\u662f\u5728\u7528\u6237\u914d\u7f6eBOUT++\u7684\u8fc7\u7a0b\u4e2d\u8bbe\u7f6e\u7684\uff0c\u548c\u5b9e\u9a8c\u5ba4\u96c6\u7fa4\u4e0a\u5b89\u88c5\u7684BOUT++\u4e0d\u4e00\u6837\u3002\u56e0\u6b64\uff0c\u8981\u94fe\u63a5\u96c6\u7fa4\u4e0a\u5b89\u88c5\u7684BOUT++\u5e93\uff0c\u6211\u4eec\u5c31\u4e0d\u80fd\u76f4\u63a5\u7528\u7b97\u4f8b\u76ee\u5f55\u4e0b\u73b0\u6709\u7684makefile\uff0c\u9700\u8981\u6309\u7167BOUT++\u5b98\u7f51\u7684\u8bf4\u660e\u4fee\u6539makefile\u3002\\n\\n\u4ee5`examples/conduction/makefile`\u4e3a\u4f8b\u94fe\u63a5\u5b9e\u9a8c\u5ba4\u96c6\u7fa4\u4e0a\u5b89\u88c5\u7684BOUT++\u5e93\uff1a\\n\\n```bash\\n## \u52a0\u8f7dSpack\u73af\u5883\\n$ source /apps/spack/share/spack/setup-env.sh\\n\\n## \u52a0\u8f7dBOUT++\uff0c\u5982\u679c\u6709\u591a\u4e2aBOUT++\u5305\uff0c\u8bf7\u6309\u7167\u96c6\u7fa4\u6587\u6863\u4e2dSpack\u4f7f\u7528\u8bf4\u660e\u6765\u7b5b\u9009\\n## \u6700\u7ec8\u63d0\u4ea4\u811a\u672c\u5230\u96c6\u7fa4\u8fd0\u884c\u7b97\u4f8b\u65f6\uff0c\u4e5f\u8981\u7528\u8fd9\u4e00\u53e5\u6765\u52a0\u8f7d\u73af\u5883\\n$ spack load bout-dev +openmp+scorep\\n\\n## \u76ee\u524d\uff0c\u5728\u96c6\u7fa4\u4e0a\u5b89\u88c5\u7684BOUT++\u81f3\u5c11\u6709OpenMP\u548c\u975eOpenMP\u4e24\u4e2a\u7248\u672c\\n## spack load bout-dev ~openmp+scorep\\n\\n## \u8fdb\u5165\u81ea\u5df1\u4e0b\u8f7d\u7684BOUT++\u7b97\u4f8b\u76ee\u5f55\\n$ cd BOUT-dev/examples/conduction\\n\\n## \u4fee\u6539makefile\uff0c\u65b0makefile\u7684\u4f8b\u5b50\u5728examples/make-script\u4e2d\\n$ sed -e \'s/test.cxx/conduction.cxx/g\' ../make-script/makefile > makefile\\n\\n## \u521b\u5efa\u53ef\u6267\u884c\u6587\u4ef6\\n$ make clean && make\\n```\\n\\n\u6267\u884c\u4e0a\u8ff0\u547d\u4ee4\u540e\uff0c\u6211\u4eec\u5c31\u5f97\u5230\u4e86\u7b97\u4f8b\u7684\u53ef\u6267\u884c\u6587\u4ef6`conduction`\u3002\\n\\n\u82e5\u8981\u4f7f\u7528BOUT++\u6e90\u4ee3\u7801\u76ee\u5f55\u4e0b\u7684Python\u5305\uff0c\u6709\u4e24\u79cd\u9009\u62e9\uff1a\u7528\u81ea\u5df1\u4e0b\u8f7d\u7684\uff0c\u6216\u7528\u96c6\u7fa4\u4e0a\u5df2\u5b89\u88c5\u7684\u3002\u81ea\u5df1\u4e0b\u8f7d\u7684\u53ef\u53c2\u8003\u6587\u540e\u7684\u94fe\u63a5\u3002\u4e0b\u9762\u6f14\u793a\u5982\u4f55\u4f7f\u7528\u96c6\u7fa4\u4e0a\u5df2\u6709\u7684\u3002\\n\\n```bash\\n## \u52a0\u8f7d\u96c6\u7fa4\u7684BOUT++\u5305\\n$ spack load bout-dev +openmp+scorep\\n\\n## \u4f7f\u7528bout-config\u83b7\u53d6Python\u5305\u8def\u5f84\u5e76\u6dfb\u52a0\u5230\u73af\u5883\u53d8\u91cf\u4e2d\\n$ export PYTHONPATH=$(bout-config --python):$PYTHONPATH\\n```\\n\\n\u6267\u884c\u4e0a\u8ff0\u547d\u4ee4\u540e\uff0c\u4fbf\u53ef\u5728\u4f7f\u7528Python\u65f6\u5bfc\u5165BOUT++\u7684Python\u5305\u3002\\n\\n## \u4f7f\u7528\u96c6\u7fa4\u4e0a\u5b89\u88c5\u7684\u4f9d\u8d56\u9879\u7f16\u8bd1BOUT++\\n\\n\u5f53\u6211\u4eec\u60f3\u91cd\u65b0\u7f16\u8bd1BOUT++\u65f6\uff0c\u53ef\u4ee5\u4f7f\u7528\u96c6\u7fa4\u4e0a\u5b89\u88c5\u7684BOUT++\u4f9d\u8d56\u9879\uff0c\u901a\u5e38\u4e0d\u9700\u8981\u81ea\u5df1\u518d\u6b21\u5b89\u88c5\u3002\u6d89\u53caSpack\u7684\u64cd\u4f5c\u53ef\u53c2\u8003\u96c6\u7fa4\u6587\u6863\u4e2dSpack\u7684\u8bf4\u660e\u3002\\n\\n```bash\\n## \u52a0\u8f7dBOUT++\u7684\u4f9d\u8d56\u9879\uff0c\u4f46\u4e0d\u52a0\u8f7dBOUT++\u672c\u8eab\\n$ spack load --only dependencies bout-dev ~openmp+scorep\\n\\n## \u8fdb\u5165\u81ea\u5df1\u4e0b\u8f7d\u7684BOUT++\u76ee\u5f55\\n$ cd BOUT-dev\\n\\n## \u6309\u7167\u81ea\u5df1\u7684\u9700\u8981\u5b8c\u6210build\\n$ ./configure --with-petsc --with-sundials && make -j16\\n```\\n\\n## \u53c2\u8003\u8d44\u6599\\n\\n- [BOUT++ - Getting started](https://bout-dev.readthedocs.io/en/latest/user_docs/installing.html)\\n- [BOUT++ - Python configuration](https://bout-dev.readthedocs.io/en/latest/user_docs/installing.html#python-configuration)\\n- [BOUT++ - Installing BOUT++(experimental)](https://bout-dev.readthedocs.io/en/latest/user_docs/installing.html#installing-bout-experimental)"},{"id":"one-reset-spack-env","metadata":{"permalink":"/cluster-docs/blog/one-reset-spack-env","editUrl":"https://github.com/hpcde/cluster-docs/blob/master/blog/2020-12-11-one-reset-spack-env.md","source":"@site/blog/2020-12-11-one-reset-spack-env.md","title":"\u5207\u6362Spack\u73af\u5883\u53d8\u91cf","description":"Spack\u7684\u73af\u5883\u53d8\u91cf\u3001\u81ea\u52a8\u8865\u5168\u7b49\u90fd\u7531Spack\u76ee\u5f55\u4e0b\u7684\u811a\u672c\u8bbe\u7f6e\u3002\u4f8b\u5982\uff0c\u4e3abash\u8bbe\u7f6e\u73af\u5883\u53d8\u91cf\u7684\u547d\u4ee4\u4e3a","date":"2020-12-11T00:00:00.000Z","formattedDate":"December 11, 2020","tags":[{"label":"tutorial","permalink":"/cluster-docs/blog/tags/tutorial"},{"label":"spack","permalink":"/cluster-docs/blog/tags/spack"}],"readingTime":3.485,"truncated":true,"authors":[{"name":"one","title":"PhD student at USTB","url":"https://github.com/alephpiece","imageURL":"https://github.com/alephpiece.png"}],"frontMatter":{"slug":"one-reset-spack-env","title":"\u5207\u6362Spack\u73af\u5883\u53d8\u91cf","author":"one","author_title":"PhD student at USTB","author_url":"https://github.com/alephpiece","author_image_url":"https://github.com/alephpiece.png","tags":["tutorial","spack"]},"prevItem":{"title":"\u4f7f\u7528\u96c6\u7fa4\u4e0a\u5b89\u88c5\u7684BOUT++\u5e93","permalink":"/cluster-docs/blog/one-bout-dev-usage"},"nextItem":{"title":"\u4e00\u4e9b\u6709\u7528\u7684\u53c2\u8003\u8d44\u6599","permalink":"/cluster-docs/blog/helpful-links"}},"content":"Spack\u7684\u73af\u5883\u53d8\u91cf\u3001\u81ea\u52a8\u8865\u5168\u7b49\u90fd\u7531Spack\u76ee\u5f55\u4e0b\u7684\u811a\u672c\u8bbe\u7f6e\u3002\u4f8b\u5982\uff0c\u4e3abash\u8bbe\u7f6e\u73af\u5883\u53d8\u91cf\u7684\u547d\u4ee4\u4e3a\\n\\n```bash\\n$ export SPACK_ROOT=/path/to/spack\\n$ source $SPACK_ROOT/share/spack/setup-env.sh\\n```\\n\\n\u5f53\u6211\u4eec\u6709\u591a\u4e2aSpack\u65f6\uff0c\u76f4\u63a5`source`\u5176\u4e2d\u4e00\u4e2aSpack\u7684\u73af\u5883\u914d\u7f6e\u811a\u672c\u53ef\u80fd\u4e0d\u4f1a\u8fbe\u5230\u9884\u671f\u6548\u679c\u3002\u6bd4\u5982\uff0c\u9996\u5148\u52a0\u8f7d\u4e86\u96c6\u7fa4\u7684\u516c\u5171Spack\uff0c\u968f\u540e\u5207\u6362\u5230\u81ea\u5df1\u7684\u672c\u5730Spack\uff0c\u5b9e\u9645\u4e0a\u4ecd\u6709\u4e9b\u73af\u5883\u662f\u516c\u5171Spack\u8bbe\u7f6e\u7684\u3002\u6b64\u65f6\u6211\u4eec\u9700\u8981\u6e05\u9664\u4e00\u4e0b\u65e7\u7684\u73af\u5883\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n> \u4ee5\u4e0b\u5747\u4ee5bash\u4e3a\u4f8b\u3002\\n\\n## Spack\u7684\u73af\u5883\u53d8\u91cf\\n\\nSpack\u7684\u73af\u5883\u914d\u7f6e\u811a\u672c`setup-env.sh`\u5b9e\u9645\u4e0a\u4f1a\u5982\u4e0b\u4fee\u6539\u7528\u6237\u7684\u73af\u5883\uff1a\\n\\n- \u4fee\u6539\u53d8\u91cf`SPACK_ROOT`\uff1b\\n- \u4fee\u6539\u53d8\u91cf`PATH`\uff0c\u6dfb\u52a0`$SPACK_ROOT/bin`\uff0c\u4f46\u8be5\u76ee\u5f55\u5df2\u5b58\u5728\u65f6\u4f1a\u8df3\u8fc7\u4fee\u6539\uff1b\\n- \u5b9a\u4e49\u51fd\u6570`_spack_shell_wrapper`\uff0c\u662f\u5904\u7406Spack\u547d\u4ee4\u7684\u51fd\u6570\uff1b\\n- \u5b9a\u4e49\u51fd\u6570`spack`\uff0c\u662f\u7ed9\u7528\u6237\u4f7f\u7528\u7684\u3002\\n\\n\u5982\u679c\u4ee5\u4e0a\u73af\u5883\u90fd\u5df2\u88ab\u8bbe\u7f6e\uff0c\u518d`source`\u53e6\u4e00\u4e2a\u8def\u5f84\u4e0b\u7684Spack\uff0c\u5f88\u53ef\u80fd\u53ea\u6709`SPACK_ROOT`\u88ab\u4fee\u6539\u3002\u6b64\u65f6\u7528\u6237\u4f7f\u7528`which spack`\u7b49\u547d\u4ee4\u90fd\u53ea\u80fd\u627e\u5230\u65e7\u7684\u53d8\u91cf\u548c\u51fd\u6570\u3002\u5c24\u5176\u662f\uff0c\u5982\u679c`PATH`\u6ca1\u6709\u6b63\u786e\u88ab\u4fee\u6539\uff0c\u7528\u6237\u5b9e\u9645\u6267\u884c\u7684\u53ef\u6267\u884c\u6587\u4ef6\u4ecd\u7136\u6765\u81ea\u4e8e\u65e7\u8def\u5f84\u3002\\n\\n## \u91cd\u7f6eSpack\u7684\u73af\u5883\\n\\n\u5207\u6362Spack\u6700\u5e72\u51c0\u7684\u65b9\u6cd5\u5c31\u662f\u91cd\u65b0\u5f00shell\uff0c\u91cd\u65b0`source`\u914d\u7f6e\u811a\u672c\u3002\u5982\u679c\u4e00\u5b9a\u8981\u5728\u5f53\u524dshell\u5207\u6362Spack\uff0c\u53ef\u4ee5\u624b\u52a8\u5220\u9664\u65e7\u7684\u73af\u5883\u53d8\u91cf`PATH`\u548c\u51fd\u6570`_spack_shell_wrapper`\u3001`spack`\u3002\u5982\u679cSpack\u7248\u672c\u5dee\u7684\u4e0d\u591a\uff0c\u5b9e\u9645\u4e0a\u53ea\u9700\u8981\u4fee\u6539`PATH`\u5c31\u5dee\u4e0d\u591a\u80fd\u6b63\u5e38\u4f7f\u7528\u3002\\n\\n\u4e0b\u9762\u63d0\u4f9b\u4e00\u4e2a\u53ef\u4ee5\u5220\u9664\u8fd9\u4e9b\u73af\u5883\u7684\u811a\u672c\u3002\u8be5\u811a\u672c\u7684\u8f93\u5165\u53c2\u6570\u4e3aSpack\u7684`setup-env.sh`\u8def\u5f84\u3002\\n\\n```bash\\n#   Script:\\n#       reset-env.sh\\n#   Usage:\\n#       source ./reset-env.sh /path/to/setup-env.sh\\n#\\n#!/bin/bash\\n\\nunset_spack_path() {\\n    # Figure out Spack paths\\n    local spack_script=$1\\n    local spack_share_dir=\\"$(cd \\"$(dirname $spack_script)\\" > /dev/null && pwd)\\"\\n    local spack_prefix=\\"$(cd \\"$(dirname $(dirname $spack_share_dir))\\" > /dev/null && pwd)\\"\\n    local spack_bin=\\"${spack_prefix%/}/bin\\"\\n\\n    # Remove the specified directory from PATH\\n    local path_old=$PATH\\n    local path_canonical=\\":$path_old:\\"\\n\\n    if [[ \\"$path_canonical\\" =~ \\":$spack_bin:\\" ]];\\n    then\\n        # Remove the given directory\\n        local path_new=\\"${spack_bin}${path_canonical//:$spack_bin:/:}\\"\\n\\n        # Remove the tail colon\\n        path_new=${path_new%:}\\n\\n        # Export PATH, this will change the user environment\\n        export PATH=$path_new\\n\\n        echo \\"removed from PATH: $spack_bin\\"\\n    else\\n        echo \\"removed nothing\\"\\n    fi\\n}\\n\\nunset_spack_func() {\\n    # Spack functions\\n    local spack_functions=(spack _spack_shell_wrapper)\\n\\n    for i in \\"${spack_functions[@]}\\"\\n    do\\n        if [ -n $i ] && [ \\"$(type -t $i)\\" = function ]\\n        then\\n            # This is supposed to change the user environment\\n            unset -f $i\\n            echo \\"unset function: $i\\"\\n        else\\n            echo \\"$i not found\\"\\n        fi\\n    done\\n}\\n\\necho -e \\"\\\\nRemoving Spack directory from PATH...\\"\\nunset_spack_path \\"$1\\"\\n\\necho -e \\"\\\\nUnsetting Spack functions...\\"\\nunset_spack_func\\n\\necho -e \\"\\\\nSourcing ${1}...\\"\\nsource \\"$1\\" &> /dev/null\\nif [ $? != 0 ]; then\\n    echo \\"failed to source $1\\"\\nfi\\n\\necho -e \\"\\\\nNow, you can run following commands for checking\\"\\necho -e \\"\\\\t$ which spack\\"\\necho -e \\"\\\\t$ env | grep -i spack\\"\\n```\\n\\n\u8be5\u811a\u672c\u9700\u8981`source`\uff0c\u4f7f\u7528\u65b9\u5f0f\u5982\u4e0b\\n```bash\\nexport SPACK_ROOT=/path/to/new/spack\\n$ source ./reset-env.sh $SPACK_ROOT/share/spack/setup-env.sh\\n```\\n\\n\u811a\u672c\u4e2d\u7684`unset_spack_path`\u7528\u4e8e\u8ba1\u7b97\u4e00\u4e9b\u8def\u5f84\u5e76\u4fee\u6539\u7528\u6237\u7684`PATH`\uff0c\u6267\u884c\u5b8c\u540e\uff0c\u7528\u6237\u63d0\u4f9b\u7684\u65b0Spack\u7684\u8def\u5f84\u4f1a\u5e76\u52a0\u5230`PATH`\u6700\u524d\u9762\u3002`unset_spack_func`\u7528\u4e8e\u6e05\u9664\u65e7\u7684\u51fd\u6570\u3002"},{"id":"helpful-links","metadata":{"permalink":"/cluster-docs/blog/helpful-links","editUrl":"https://github.com/hpcde/cluster-docs/blob/master/blog/2020-11-25-helpful-links.md","source":"@site/blog/2020-11-25-helpful-links.md","title":"\u4e00\u4e9b\u6709\u7528\u7684\u53c2\u8003\u8d44\u6599","description":"\u8fd9\u91cc\u63d0\u4f9b\u4e00\u4e9b\u6709\u7528\u7684\u53c2\u8003\u8d44\u6599, \u4e3b\u8981\u662f\u5173\u4e8e Slurm \u7cfb\u7edf\u3001Linux\u3001DCU/GPU\u3001\u7f16\u8bd1\u8c03\u8bd5\u76f8\u5173\u7684\u5185\u5bb9\u3002","date":"2020-11-25T00:00:00.000Z","formattedDate":"November 25, 2020","tags":[{"label":"hello","permalink":"/cluster-docs/blog/tags/hello"}],"readingTime":0.705,"truncated":true,"authors":[{"name":"genshen","title":"PhD student at USTB","url":"https://github.com/genshen","imageURL":"https://secure.gravatar.com/avatar/15520bc606e6177300abacab337a5dc6?s=800&d=identicon"}],"frontMatter":{"slug":"helpful-links","title":"\u4e00\u4e9b\u6709\u7528\u7684\u53c2\u8003\u8d44\u6599","author":"genshen","author_title":"PhD student at USTB","author_url":"https://github.com/genshen","author_image_url":"https://secure.gravatar.com/avatar/15520bc606e6177300abacab337a5dc6?s=800&d=identicon","tags":["hello"]},"prevItem":{"title":"\u5207\u6362Spack\u73af\u5883\u53d8\u91cf","permalink":"/cluster-docs/blog/one-reset-spack-env"}},"content":"\u8fd9\u91cc\u63d0\u4f9b\u4e00\u4e9b\u6709\u7528\u7684\u53c2\u8003\u8d44\u6599, \u4e3b\u8981\u662f\u5173\u4e8e Slurm \u7cfb\u7edf\u3001Linux\u3001DCU/GPU\u3001\u7f16\u8bd1\u8c03\u8bd5\u76f8\u5173\u7684\u5185\u5bb9\u3002  \\n\u76f8\u5173\u8d44\u6599\u4f1a\u4e0d\u5b9a\u671f\u66f4\u65b0\u3002\\n\\n### HPC \u7406\u8bba\\n- [Introduction to Parallel Computing](https://computing.llnl.gov/tutorials/parallel_comp/)\\n\\n### Slurm\\n- [SLURM\u8c03\u5ea6\u5668\u57fa\u7840\u6559\u7a0b: \u66d9\u5149\u5148\u8fdb\u8ba1\u7b97](https://www.hpccube.com/wiki/index.php/SLURM\u4f7f\u7528\u57fa\u7840\u6559\u7a0b)\\n- [Research Computing University of Colorado Boulder](https://curc.readthedocs.io/en/latest/running-jobs/slurm-commands.html)\\n\\n### Linux\\n- [Linux\u547d\u4ee4\u5927\u5168](https://man.linuxde.net)\\n- [\u9ce5\u54e5\u7684 Linux \u79c1\u623f\u83dc](https://linux.vbird.org)\\n\\n### \u8c03\u8bd5\\n- [GDB to LLDB command map](https://lldb.llvm.org/use/map.html)\\n\\n### \u7f16\u8f91\u5668\\n- [Vim \u4ece\u5165\u95e8\u5230\u7cbe\u901a-\u4e2d\u6587](https://github.com/wsdjeg/vim-galore-zh_cn)\\n- [Learn-Vim](https://github.com/iggredible/Learn-Vim)\\n\\n### \u76f8\u5173\u94fe\u63a5\\n- [\u4e0a\u6d77\u4ea4\u901a\u5927\u5b66 Pi \u8d85\u7b97\u96c6\u7fa4\u6587\u6863](https://docs.hpc.sjtu.edu.cn)\\n\\n\x3c!--truncate--\x3e"}]}')}}]);